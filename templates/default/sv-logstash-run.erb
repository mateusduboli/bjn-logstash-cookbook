#!/bin/sh
export LOGSTASH_HOME="<%= node['logstash']['home'] %>" # Required for SinceDB
export LOGSTASH_LOGS="<%= node['logstash']['logs'] %>"
export LOGSTASH_OPTS="agent -f <%= node['logstash']['conf'] %>"
export LOGSTASH_OPTS="$LOGSTASH_OPTS -l $LOGSTASH_LOGS/logstash.log"
export LOGSTASH_OPTS="$LOGSTASH_OPTS -w <%= node['logstash']['workers'] %>"
<% if node['logstash']['debug?'] %>
export LOGSTASH_OPTS="$LOGSTASH_OPTS --debug --verbose"
<% end %>
export HOME="$LOGSTASH_HOME" # Again, for SinceDB
export USE_JRUBY=1
<% if node['logstash']['heap_size'] %>
export LS_HEAP_SIZE="<%= node['logstash']['heap_size'] %>"
<% end %>
exec 2>&1
cd $LOGSTASH_HOME # Necessary for logstash to work properly
CMD="$LOGSTASH_HOME/bin/logstash $LOGSTASH_OPTS"
exec chpst -u <%= node['logstash']['user'] %> $CMD