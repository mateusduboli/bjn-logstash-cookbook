input {

<% node['logstash']['input'].each do |type, inputs| %>
<% inputs.each do |name, config| %>
  <%= name %> {<% config.each do |k, v| %>
    <%= k %> => <%= quote_logstash v %><% end %>
    <% unless type.nil? %>type => <%= quote_logstash type %><% end %>
  }

<% end %><% end %>
}


filter {

<% node['logstash']['filter'].each do |type, filters| %>
  <% if type.is_a?(String) %>if [type] == <%= quote_logstash type %> {<% end %>

  <% filters.each do |name, config| %>
    <%= name %> {<%= "\n" if config.keys.empty? %><% config.each do |k, v| %>
      <%= k %> => <%= quote_logstash v %><% end %>
    }

<% end %><% if type.is_a?(String) %>  }
<% end %><% end %>
}


output {

<% node['logstash']['output'].each do |type, outputs| %>
  <% if type.is_a?(String) %>if [type] == <%= quote_logstash type %> {<% end %>

  <% outputs.each do |name, config| %>
    <%= name %> {<% config.each do |k, v| %>
      <%= k %> => <%= quote_logstash v %><% end %>
    }

<% end %><% if type.is_a?(String) %>  }
<% end %><% end %>
}